<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!-- CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>

    <meta charset="utf-8" />
    <title></title>

    <style>
        body {
            background: #f4f4f4;
        }

        .banner {
            background: #a770ef;
            background: -webkit-linear-gradient(to right, #a770ef, #cf8bf3, #fdb99b);
            background: linear-gradient(to right, #a770ef, #cf8bf3, #fdb99b);
        }
    </style>

</head>
<body>
    <div class="container-fluid">
        <div class="px-lg-5">

            <!-- For demo purpose -->
            <div class="row py-5">
                <div class="col-lg-12 mx-auto">
                    <div class="text-white p-5 shadow-sm rounded banner">
                        <h1 class="display-4">ESP8266 Logs</h1>
                        <p class="lead">Thief-warning Logs</p>
                    </div>
                </div>
            </div>
            <!-- End -->

            <div class="row" id="container">
                <!-- Gallery item -->
                <!--<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="bg-white rounded shadow-sm">
                        <img src="https://res.cloudinary.com/mhmd/image/upload/v1556294929/matthew-hamilton-351641-unsplash_zmvozs.jpg" alt="" class="img-fluid card-img-top">
                        <div class="p-4">
                            <h5> <a href="#" class="text-dark">Red paint cup</a></h5>
                            <div class="d-flex align-items-center justify-content-between rounded-pill bg-light px-3 py-2 mt-4">
                                <p class="small mb-0"><i class="fa fa-picture-o mr-2"></i><span class="font-weight-bold">JPG</span></p>
                                <div class="badge badge-danger px-3 rounded-pill font-weight-normal">New</div>
                            </div>
                        </div>
                    </div>
                </div>-->
                <!-- End -->
                <!-- Gallery item -->
                <!--<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="bg-white rounded shadow-sm">
                        <img src="https://res.cloudinary.com/mhmd/image/upload/v1556294927/cody-davis-253928-unsplash_vfcdcl.jpg" alt="" class="img-fluid card-img-top">
                        <div class="p-4">
                            <h5> <a href="#" class="text-dark">Blorange</a></h5>
                            <div class="d-flex align-items-center justify-content-between rounded-pill bg-light px-3 py-2 mt-4">
                                <p class="small mb-0"><i class="fa fa-picture-o mr-2"></i><span class="font-weight-bold">PNG</span></p>
                                <div class="badge badge-primary px-3 rounded-pill font-weight-normal">New</div>
                            </div>
                        </div>
                    </div>
                </div>-->
                <!-- End -->
                <!-- Gallery item -->
                <!--<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="bg-white rounded shadow-sm">
                        <img src="https://res.cloudinary.com/mhmd/image/upload/v1556294928/nicole-honeywill-546848-unsplash_ymprvp.jpg" alt="" class="img-fluid card-img-top">
                        <div class="p-4">
                            <h5> <a href="#" class="text-dark">And She Realized</a></h5>
                            <div class="d-flex align-items-center justify-content-between rounded-pill bg-light px-3 py-2 mt-4">
                                <p class="small mb-0"><i class="fa fa-picture-o mr-2"></i><span class="font-weight-bold">JPG</span></p>
                                <div class="badge badge-warning px-3 rounded-pill font-weight-normal text-white">Yesterday</div>
                            </div>
                        </div>
                    </div>
                </div>-->
                <!-- End -->
                <!-- Gallery item -->
                <!--<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="bg-white rounded shadow-sm">
                        <img src="https://res.cloudinary.com/mhmd/image/upload/v1556294927/dose-juice-1184444-unsplash_bmbutn.jpg" alt="" class="img-fluid card-img-top">
                        <div class="p-4">
                            <h5> <a href="#" class="text-dark">DOSE Juice</a></h5>
                            <div class="d-flex align-items-center justify-content-between rounded-pill bg-light px-3 py-2 mt-4">
                                <p class="small mb-0"><i class="fa fa-picture-o mr-2"></i><span class="font-weight-bold">JPEG</span></p>
                                <div class="badge badge-success px-3 rounded-pill font-weight-normal">Normal</div>
                            </div>
                        </div>
                    </div>
                </div>-->
                <!-- End -->

            </div>
            <!--<div class="py-5 text-right"><a href="#" class="btn btn-dark px-5 py-3 text-uppercase">Show me more</a></div>-->
        </div>
    </div>



    <!-- Gallery item -->
    <div id="card" class="col-xl-3 col-lg-4 col-md-6 mb-4" style="display:none">
        <div class="bg-white rounded shadow-sm">
            <img src="" alt="" class="img-fluid card-img-top">
            <div class="p-4">
                <h5 class="text-dark">DOSE Juice</h5>
                <div class="d-flex align-items-center justify-content-between rounded-pill bg-light px-3 py-2 mt-4">
                    <p class="small mb-0"><i class="fa fa-picture-o mr-2"></i><span class="font-weight-bold">JPEG</span></p>
                    <div id="tag" class="">Normal</div>
                </div>
            </div>
        </div>
    </div>
    <!-- End -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyAextH1u5uq3LlcZ-5SoMdhuPuwx1jcl6E",
            authDomain: "thiefrag-65129.firebaseapp.com",
            databaseURL: "https://thiefrag-65129-default-rtdb.firebaseio.com",
            projectId: "thiefrag-65129",
            storageBucket: "thiefrag-65129.appspot.com",
            messagingSenderId: "72980298760",
            appId: "1:72980298760:web:37ddd00445e53b487925bd"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        // Get a reference to the database service

        const cardTemplate = jQuery("#card");
        const tag = {
            normal: "badge badge-success px-3 rounded-pill font-weight-normal",
            new: "badge badge-danger px-3 rounded-pill font-weight-normal",
            yesterday: "badge badge-warning px-3 rounded-pill font-weight-normal text-white",
        }
        const tagTitle = {
            normal: "Normal",
            new: "New",
            yesterday: "Yesterday",
        }
        jQuery(document).ready(function () {
            const dbRef = firebase.database().ref();
            dbRef.child("logs").get().then((snapshot) => {
                if (snapshot.exists()) {
                    for (var key in snapshot.val()) {
                        InitializeLog(snapshot.val()[key], key);
                    }
                } else {
                    console.log("No data available");
                }
            }).catch((error) => {
                console.error(error);
            });
        });
        function InitializeLog(log, timestampInSec) {
            const timestamp = Math.round(new Date().getTime() / 1000);
            var item = cardTemplate.clone().appendTo("#container");
            jQuery(item).find("img").attr("src", log.snapshotUrl);
            jQuery(item).find(".text-dark").html("Datetime: " + log.datetime);
            if (timestamp - timestampInSec <= 86400) {
                jQuery(item).find("#tag").addClass(tag.new);
                jQuery(item).find("#tag").html(tagTitle.new);
            }
            else if (timestamp - timestampInSec <= 86400 * 2) {
                jQuery(item).find("#tag").addClass(tag.yesterday);
                jQuery(item).find("#tag").html(tagTitle.yesterday);
            }
            else {
                jQuery(item).find("#tag").addClass(tag.normal);
                jQuery(item).find("#tag").html(tagTitle.normal);
            }
            item.show();
        }
    </script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
</body>
</html>